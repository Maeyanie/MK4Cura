[general]
version = 4
name = Prusa i3 Mk4_settings
definition = prusa_i3_mk3

[metadata]
type = definition_changes
setting_version = 19

[values]
machine_end_gcode = M104 S0 ; turn off temperature
	M140 S0 ; turn off heatbed
	M107 ; turn off fan
	G1 X241 Y170 F3600 ; park
	G4 ; wait
	M900 K0 ; reset LA
	M142 S36 ; reset heatbreak target temp
	M84 X Y E ; disable motors
	
	; filament used [mm] = {filament_amount}
	; filament used [cm3] = 0.00
	; filament used [g] = {filament_weight}
	; filament cost = {filament_cost}
	; total filament used [g] = {filament_weight}
	; total filament cost = {filament_cost}
	; total filament used for wipe tower [g] = 0.00
	; estimated printing time (normal mode) = {print_time}
	; estimated first layer printing time (normal mode) = 0s
machine_height = 210.0
machine_start_gcode = M17 ; enable steppers
	M862.3 P "MK4" ; printer model check
	M862.1 P{machine_nozzle_size} ; nozzle diameter check
	M115 U5.1.2+13478
	M555 X0 Y0 W250 H210 ; According to a forum post the dimensions are not available as a Cura replacement, so hardcoding the bed size.
	
	G21 ; set units to millimeters
	G90 ; use absolute coordinates
	M82 ; absolute extrusion mode
	
	M140 S{material_bed_temperature_layer_0} ; set bed temp
	M104 T0 S175 ; set extruder temp for bed leveling
	M109 T0 R175 ; wait for temp
	
	M84 E ; turn off E motor
	
	G28 ; home all without mesh bed level
	
	G1 X42 Y-4 Z5 F4800
	
	M302 S160 ; lower cold extrusion limit to 160C
	
	G92 E0
	G1 E-2 F2400 ; retraction
	
	M84 E ; turn off E motor
	
	G29 P9 X10 Y-4 W32 H4
	
	G0 Z40 F10000
	
	M190 S{material_bed_temperature_layer_0} ; wait for bed temp
	
	M107
	
	;
	; MBL
	;
	M84 E ; turn off E motor
	G29 P1 ; invalidate mbl & probe print area
	G29 P1 X0 Y0 W50 H20 C ; probe near purge place
	G29 P3.2 ; interpolate mbl probes
	G29 P3.13 ; extrapolate mbl outside probe area
	G29 A ; activate mbl
	
	; prepare for purge
	M104 S{material_print_temperature_layer_0}
	G0 X0 Y-4 Z15 F4800 ; move away and ready for the purge
	M109 S{material_print_temperature_layer_0}
	
	G92 E0
	M569 S0 E ; set spreadcycle mode for extruder
	
	;
	; Extrude purge line
	;
	G92 E0 ; reset extruder position
	G1 E2 F2400 ; deretraction after the initial one before nozzle cleaning
	G0 E7 X15 Z0.2 F500 ; purge
	G0 X25 E11 F500 ; purge
	G0 X35 E15 F650 ; purge
	G0 X45 E19 F800 ; purge
	G0 X48 Z0.05 F8000 ; wipe, move close to the bed
	G0 X96 Z0.2 F8000 ; wipe, move quickly away from the bed
	
	G92 E0
	M221 S100 ; set flow to 100%
machine_use_extruder_offset_to_offset_coords = False

